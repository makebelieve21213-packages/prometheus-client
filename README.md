# @makebelieve21213-packages/prometheus-client

Prometheus –∫–ª–∏–µ–Ω—Ç –¥–ª—è NestJS —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–µ—Ç—Ä–∏–∫, —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å @willsoto/nestjs-prometheus.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å @willsoto/nestjs-prometheus** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ –Ω–∞ `/metrics` endpoint
- ‚úÖ **Type-safe API** - –ø–æ–ª–Ω–∞—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å TypeScript
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫** - Counter, Histogram, Gauge, Summary –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã** - –≥–æ—Ç–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è HTTP, Kafka –∏ AI –º–µ—Ç—Ä–∏–∫
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä HTTP –º–µ—Ç—Ä–∏–∫** - –∏–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç—Ä–µ–∫–∏–Ω–≥–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã** - `@TrackDuration`, `@TrackCounter`, `@PrometheusMetric` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Ç—Ä–µ–∫–∏–Ω–≥–∞
- ‚úÖ **–ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –º–µ—Ç—Ä–∏–∫** - –≥–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã –¥–ª—è HTTP, Kafka –∏ Database
- ‚úÖ **–†–µ–µ—Å—Ç—Ä –º–µ—Ç—Ä–∏–∫** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- ‚úÖ **–£—Ç–∏–ª–∏—Ç—ã** - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- ‚úÖ **Registry management** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–µ—Å—Ç—Ä–æ–º –º–µ—Ç—Ä–∏–∫
- ‚úÖ **Global Module** - —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö
- ‚úÖ **100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏** - –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- ‚úÖ **ESM –º–æ–¥—É–ª—å** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –º–æ–¥—É–ª–µ–π JavaScript
- ‚úÖ **TypeScript** - –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
pnpm add @makebelieve21213-packages/prometheus-client
```

–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `package.json` –≤–∞—à–µ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞:
```json
{
  "dependencies": {
    "@makebelieve21213-packages/prometheus-client": "workspace:*"
  }
}
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ AppModule

```typescript
import { Module } from '@nestjs/common';
import { ConfigModule, ConfigService } from '@nestjs/config';
import { PrometheusClientModule } from '@makebelieve21213-packages/prometheus-client';

@Module({
  imports: [
    ConfigModule.forRoot({ isGlobal: true }),
    PrometheusClientModule.forRootAsync<[ConfigService]>({
      useFactory: (configService: ConfigService) => ({
        path: configService.get('PROMETHEUS_METRICS_PATH') || '/metrics',
        defaultMetrics: configService.get('PROMETHEUS_DEFAULT_METRICS') !== 'false',
        httpMetrics: {
          enabled: true,
          ignorePaths: ['/metrics', '/health'],
          ignoreMethods: ['OPTIONS'],
        },
      }),
      inject: [ConfigService],
    }),
  ],
})
export class AppModule {}
```

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä HTTP –º–µ—Ç—Ä–∏–∫

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ HTTP –º–µ—Ç—Ä–∏–∫:

```typescript
import { APP_INTERCEPTOR } from '@nestjs/core';
import { PrometheusHttpInterceptor } from '@makebelieve21213-packages/prometheus-client';

@Module({
  providers: [
    {
      provide: APP_INTERCEPTOR,
      useClass: PrometheusHttpInterceptor,
    },
  ],
})
export class AppModule {}
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```typescript
import { Injectable } from '@nestjs/common';
import { HttpMetricsService, KafkaMetricsService, AiMetricsService } from '@makebelieve21213-packages/prometheus-client';

@Injectable()
export default class MyService {
  constructor(
    private readonly httpMetrics: HttpMetricsService,
    private readonly kafkaMetrics: KafkaMetricsService,
    private readonly aiMetrics: AiMetricsService,
  ) {}

  async handleRequest() {
    const startTime = Date.now();
    try {
      // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
      const duration = Date.now() - startTime;
      this.httpMetrics.recordHttpRequest('GET', '/api/users', 200, duration);
    } catch (error) {
      const duration = Date.now() - startTime;
      this.httpMetrics.recordHttpError('GET', '/api/users', 500, duration, error);
    }
  }

  async processKafkaMessage(topic: string, commandType: string) {
    const startTime = Date.now();
    try {
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
      const duration = Date.now() - startTime;
      this.kafkaMetrics.recordKafkaMessage(topic, commandType, 'success', duration);
    } catch (error) {
      this.kafkaMetrics.recordKafkaError(topic, commandType, error);
    }
  }

  async processAiRequest(model: string) {
    const startTime = Date.now();
    try {
      // AI –∑–∞–ø—Ä–æ—Å
      const duration = Date.now() - startTime;
      this.aiMetrics.recordAiRequest('success', duration, 100, model);
    } catch (error) {
      const duration = Date.now() - startTime;
      this.aiMetrics.recordAiRequest('error', duration, 0, model);
    }
  }
}
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤

```typescript
import { Injectable } from '@nestjs/common';
import { TrackDuration, TrackCounter, PrometheusMetric } from '@makebelieve21213-packages/prometheus-client';

@Injectable()
export default class MyService {
  @TrackDuration('my_method_duration_seconds', { service: 'my-service' })
  @TrackCounter('my_method_calls_total', { service: 'my-service' })
  async myMethod() {
    // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
  }

  @PrometheusMetric({
    type: 'histogram',
    name: 'custom_metric_seconds',
    help: 'Custom metric description',
    labels: ['method'],
    buckets: [0.1, 0.5, 1, 2, 5],
  })
  async customMethod() {
    // –í–∞—à–∞ –ª–æ–≥–∏–∫–∞
  }
}
```

### 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ PrometheusService

```typescript
import { Injectable } from '@nestjs/common';
import { PrometheusService } from '@makebelieve21213-packages/prometheus-client';
import { Counter, Histogram, Gauge, Summary } from 'prom-client';

@Injectable()
export default class MetricsService {
  private readonly httpRequestCounter: Counter;
  private readonly httpRequestDuration: Histogram;
  private readonly activeConnections: Gauge;
  private readonly requestSummary: Summary;

  constructor(private readonly prometheusService: PrometheusService) {
    // –°–æ–∑–¥–∞–Ω–∏–µ Counter –º–µ—Ç—Ä–∏–∫–∏
    this.httpRequestCounter = this.prometheusService.createCounter({
      name: 'http_requests_total',
      help: 'Total number of HTTP requests',
      labelNames: ['method', 'route', 'status'],
    });

    // –°–æ–∑–¥–∞–Ω–∏–µ Histogram –º–µ—Ç—Ä–∏–∫–∏
    this.httpRequestDuration = this.prometheusService.createHistogram({
      name: 'http_request_duration_seconds',
      help: 'Duration of HTTP requests in seconds',
      labelNames: ['method', 'route'],
      buckets: [0.1, 0.5, 1, 2, 5],
    });

    // –°–æ–∑–¥–∞–Ω–∏–µ Gauge –º–µ—Ç—Ä–∏–∫–∏
    this.activeConnections = this.prometheusService.createGauge({
      name: 'active_connections',
      help: 'Number of active connections',
      labelNames: ['type'],
    });

    // –°–æ–∑–¥–∞–Ω–∏–µ Summary –º–µ—Ç—Ä–∏–∫–∏
    this.requestSummary = this.prometheusService.createSummary({
      name: 'request_summary_seconds',
      help: 'Request duration summary',
      labelNames: ['method'],
      percentiles: [0.5, 0.9, 0.99],
    });
  }

  recordHttpRequest(method: string, route: string, status: number, duration: number): void {
    this.httpRequestCounter.inc({ method, route, status: status.toString() });
    this.httpRequestDuration.observe({ method, route }, duration);
    this.requestSummary.observe({ method }, duration);
  }

  setActiveConnections(type: string, count: number): void {
    this.activeConnections.set({ type }, count);
  }
}
```

## üìä –ú–µ—Ç–æ–¥—ã PrometheusService

### `createCounter(config)`
–°–æ–∑–¥–∞–µ—Ç Counter –º–µ—Ç—Ä–∏–∫—É –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Å–æ–±—ã—Ç–∏–π.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `config.name` - –∏–º—è –º–µ—Ç—Ä–∏–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `config.help` - –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `config.labelNames` - –º–∞—Å—Å–∏–≤ –∏–º–µ–Ω –º–µ—Ç–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Counter` –∏–∑ `prom-client`

```typescript
const counter = prometheusService.createCounter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status'],
});

counter.inc({ method: 'GET', route: '/api/users', status: '200' });
```

### `createHistogram(config)`
–°–æ–∑–¥–∞–µ—Ç Histogram –º–µ—Ç—Ä–∏–∫—É –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `config.name` - –∏–º—è –º–µ—Ç—Ä–∏–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `config.help` - –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `config.labelNames` - –º–∞—Å—Å–∏–≤ –∏–º–µ–Ω –º–µ—Ç–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `config.buckets` - –º–∞—Å—Å–∏–≤ buckets –¥–ª—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Histogram` –∏–∑ `prom-client`

```typescript
const histogram = prometheusService.createHistogram({
  name: 'http_request_duration_seconds',
  help: 'Duration of HTTP requests in seconds',
  labelNames: ['method', 'route'],
  buckets: [0.1, 0.5, 1, 2, 5],
});

const timer = histogram.startTimer({ method: 'GET', route: '/api/users' });
// ... –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
timer(); // –ó–∞–≤–µ—Ä—à–∞–µ—Ç –∏–∑–º–µ—Ä–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ
```

### `createGauge(config)`
–°–æ–∑–¥–∞–µ—Ç Gauge –º–µ—Ç—Ä–∏–∫—É –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è –∏ —É–º–µ–Ω—å—à–∞—Ç—å—Å—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `config.name` - –∏–º—è –º–µ—Ç—Ä–∏–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `config.help` - –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `config.labelNames` - –º–∞—Å—Å–∏–≤ –∏–º–µ–Ω –º–µ—Ç–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Gauge` –∏–∑ `prom-client`

```typescript
const gauge = prometheusService.createGauge({
  name: 'active_connections',
  help: 'Number of active connections',
  labelNames: ['type'],
});

gauge.set({ type: 'websocket' }, 10);
gauge.inc({ type: 'websocket' }, 1);
gauge.dec({ type: 'websocket' }, 1);
```

### `createSummary(config)`
–°–æ–∑–¥–∞–µ—Ç Summary –º–µ—Ç—Ä–∏–∫—É –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∫–≤–∞–Ω—Ç–∏–ª–µ–π.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `config.name` - –∏–º—è –º–µ—Ç—Ä–∏–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `config.help` - –æ–ø–∏—Å–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `config.labelNames` - –º–∞—Å—Å–∏–≤ –∏–º–µ–Ω –º–µ—Ç–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `config.percentiles` - –º–∞—Å—Å–∏–≤ –∫–≤–∞–Ω—Ç–∏–ª–µ–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `config.maxAgeSeconds` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç –Ω–∞–±–ª—é–¥–µ–Ω–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `config.ageBuckets` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ buckets –¥–ª—è –≤–æ–∑—Ä–∞—Å—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Summary` –∏–∑ `prom-client`

```typescript
const summary = prometheusService.createSummary({
  name: 'request_summary_seconds',
  help: 'Request duration summary',
  labelNames: ['method'],
  percentiles: [0.5, 0.9, 0.99],
});

summary.observe({ method: 'GET' }, 0.5);
```

### `getRegistry()`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Registry –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–µ—Ç—Ä–∏–∫.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** `Registry` –∏–∑ `prom-client`

```typescript
const registry = prometheusService.getRegistry();
```

## üîß –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### HttpMetricsService

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç HTTP –º–µ—Ç—Ä–∏–∫–∞–º–∏:
- `http_requests_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_request_size_bytes` - —Ä–∞–∑–º–µ—Ä HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `http_response_size_bytes` - —Ä–∞–∑–º–µ—Ä HTTP –æ—Ç–≤–µ—Ç–æ–≤
- `http_errors_total` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –æ—à–∏–±–æ–∫

```typescript
import { HttpMetricsService } from '@makebelieve21213-packages/prometheus-client';

constructor(private readonly httpMetrics: HttpMetricsService) {}

// –ó–∞–ø–∏—Å–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
this.httpMetrics.recordHttpRequest(
  'GET',
  '/api/users',
  200,
  150, // duration –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
  1024, // requestSize –≤ –±–∞–π—Ç–∞—Ö
  2048, // responseSize –≤ –±–∞–π—Ç–∞—Ö
  'UserController',
  'getUsers'
);

// –ó–∞–ø–∏—Å–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—à–∏–±–∫–∏
this.httpMetrics.recordHttpError(
  'GET',
  '/api/users',
  500,
  150,
  new Error('Internal error')
);
```

### KafkaMetricsService

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç Kafka –º–µ—Ç—Ä–∏–∫–∞–º–∏:
- `kafka_messages_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `kafka_message_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- `kafka_errors_total` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

```typescript
import { KafkaMetricsService } from '@makebelieve21213-packages/prometheus-client';

constructor(private readonly kafkaMetrics: KafkaMetricsService) {}

// –ó–∞–ø–∏—Å–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è —É—Å–ø–µ—à–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
this.kafkaMetrics.recordKafkaMessage(
  'chat.service.commands',
  'CreateMessage',
  'success',
  50 // duration –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
);

// –ó–∞–ø–∏—Å–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—à–∏–±–∫–∏
this.kafkaMetrics.recordKafkaError(
  'chat.service.commands',
  'CreateMessage',
  new Error('Processing error')
);
```

### AiMetricsService

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç AI –º–µ—Ç—Ä–∏–∫–∞–º–∏:
- `ai_stream_requests_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ stream –∑–∞–ø—Ä–æ—Å–æ–≤
- `ai_stream_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å stream –∑–∞–ø—Ä–æ—Å–æ–≤
- `ai_stream_tokens_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –≤ stream
- `ai_requests_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ AI –∑–∞–ø—Ä–æ—Å–æ–≤
- `ai_request_duration_seconds` - –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å AI –∑–∞–ø—Ä–æ—Å–æ–≤

```typescript
import { AiMetricsService } from '@makebelieve21213-packages/prometheus-client';

constructor(private readonly aiMetrics: AiMetricsService) {}

// –ó–∞–ø–∏—Å–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è stream –∑–∞–ø—Ä–æ—Å–∞
this.aiMetrics.recordAiStream(
  'success',
  5000, // duration –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
  1000 // tokens
);

// –ó–∞–ø–∏—Å–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ AI –∑–∞–ø—Ä–æ—Å–∞
this.aiMetrics.recordAiRequest(
  'success',
  3000,
  500,
  'gpt-4'
);
```

## üé® –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã

### `@TrackDuration(metricName?, labels?)`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ—Ä—è–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ Histogram –º–µ—Ç—Ä–∏–∫—É.

```typescript
import { TrackDuration } from '@makebelieve21213-packages/prometheus-client';

@TrackDuration('my_method_duration_seconds', { service: 'my-service' })
async myMethod() {
  // –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ—Ä–µ–Ω–æ
}
```

### `@TrackCounter(metricName?, labels?)`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–∞ –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ Counter –º–µ—Ç—Ä–∏–∫—É.

```typescript
import { TrackCounter } from '@makebelieve21213-packages/prometheus-client';

@TrackCounter('my_method_calls_total', { service: 'my-service' })
async myMethod() {
  // –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—á–∏—Ç–∞–Ω
}
```

### `@PrometheusMetric(config)`

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—É—é –º–µ—Ç—Ä–∏–∫—É –¥–ª—è –º–µ—Ç–æ–¥–∞.

```typescript
import { PrometheusMetric } from '@makebelieve21213-packages/prometheus-client';

@PrometheusMetric({
  type: 'histogram',
  name: 'custom_metric_seconds',
  help: 'Custom metric description',
  labels: ['method'],
  buckets: [0.1, 0.5, 1, 2, 5],
})
async customMethod() {
  // –ú–µ—Ç—Ä–∏–∫–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞
}
```

## üõ†Ô∏è –£—Ç–∏–ª–∏—Ç—ã

### –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –º–µ—Ç—Ä–∏–∫

```typescript
import {
  createHttpMetricsSet,
  createKafkaMetricsSet,
  createDatabaseMetricsSet,
} from '@makebelieve21213-packages/prometheus-client';

const httpMetrics = createHttpMetricsSet(prometheusService);
const kafkaMetrics = createKafkaMetricsSet(prometheusService);
const dbMetrics = createDatabaseMetricsSet(prometheusService);
```

### MetricTimer

–£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–ø–∏—Å—å—é –≤ Histogram.

```typescript
import { createMetricTimer } from '@makebelieve21213-packages/prometheus-client';

const timer = createMetricTimer(histogram, { method: 'GET', route: '/api/users' });
// ... –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞
timer.end(); // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```

### wrapWithMetrics

–û–±–µ—Ä—Ç–∫–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏.

```typescript
import { wrapWithMetrics } from '@makebelieve21213-packages/prometheus-client';

const wrappedFunction = wrapWithMetrics(myFunction, {
  counter: myCounter,
  histogram: myHistogram,
  counterLabels: { service: 'my-service' },
  histogramLabels: { method: 'process' },
});
```

### –†–∞–±–æ—Ç–∞ —Å –º–µ—Ç–∫–∞–º–∏

```typescript
import {
  extractHttpLabels,
  extractRequestLabels,
  createLabels,
  mergeLabels,
} from '@makebelieve21213-packages/prometheus-client';

// –ò–∑–≤–ª–µ—á—å –º–µ—Ç–∫–∏ –∏–∑ ExecutionContext
const labels = extractHttpLabels(context);

// –ò–∑–≤–ª–µ—á—å –º–µ—Ç–∫–∏ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
const requestLabels = extractRequestLabels(request);

// –°–æ–∑–¥–∞—Ç—å –º–µ—Ç–∫–∏ –∏–∑ –æ–±—ä–µ–∫—Ç–∞
const customLabels = createLabels({ method: 'GET', status: '200' }, ['method', 'status']);

// –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –º–µ—Ç–∫–∏
const merged = mergeLabels(labels1, labels2, labels3);
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–∞

```
prometheus-client/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prometheus.module.spec.ts    # –¢–µ—Å—Ç—ã –º–æ–¥—É–ª—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prometheus.service.spec.ts   # –¢–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prometheus.module.ts             # NestJS –º–æ–¥—É–ª—å (Global)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prometheus.service.ts            # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http-metrics.service.spec.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kafka-metrics.service.spec.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai-metrics.service.spec.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http-metrics.service.ts          # –°–µ—Ä–≤–∏—Å –¥–ª—è HTTP –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ kafka-metrics.service.ts         # –°–µ—Ä–≤–∏—Å –¥–ª—è Kafka –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ai-metrics.service.ts            # –°–µ—Ä–≤–∏—Å –¥–ª—è AI –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îú‚îÄ‚îÄ interceptors/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prometheus-http.interceptor.spec.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prometheus-http.interceptor.ts   # HTTP –∏–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ decorators/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prometheus-metric.decorator.spec.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ track-duration.decorator.spec.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ track-counter.decorator.spec.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prometheus-metric.decorator.ts   # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ track-duration.decorator.ts     # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ track-counter.decorator.ts       # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ –≤—ã–∑–æ–≤–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ injection-keys.spec.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metric-labels.spec.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metric-registry.spec.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metric-sets.spec.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metric-timer.spec.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metric-wrapper.spec.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ injection-keys.ts               # DI —Ç–æ–∫–µ–Ω—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metric-labels.ts                 # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–µ—Ç–∫–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metric-registry.ts              # –†–µ–µ—Å—Ç—Ä –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metric-sets.ts                   # –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä—ã –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metric-timer.ts                  # –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metric-wrapper.ts                # –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ module-options.interface.ts     # –û–ø—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prometheus.interface.ts         # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å PrometheusClientContract
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metric-sets.interface.ts        # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –Ω–∞–±–æ—Ä–æ–≤ –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metric-wrapper.interface.ts    # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–ø—Ü–∏–π –æ–±–µ—Ä—Ç–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prometheus-metric.interface.ts  # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îî‚îÄ‚îÄ index.ts                            # –≠–∫—Å–ø–æ—Ä—Ç—ã –ø–∞–∫–µ—Ç–∞
‚îú‚îÄ‚îÄ dist/                                   # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### PrometheusModuleOptions

```typescript
interface PrometheusModuleOptions {
  path?: string;              // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—É—Ç—å –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–µ—Ç—Ä–∏–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é "/metrics")
  defaultMetrics?: boolean;    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤–∫–ª—é—á–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Node.js (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
  httpMetrics?: HttpMetricsOptions;  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ–ø—Ü–∏–∏ –¥–ª—è HTTP –º–µ—Ç—Ä–∏–∫
  predefinedMetrics?: PredefinedMetricsConfig;  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
}

interface HttpMetricsOptions {
  enabled?: boolean;          // –í–∫–ª—é—á–∏—Ç—å —Å–±–æ—Ä HTTP –º–µ—Ç—Ä–∏–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: true)
  ignorePaths?: string[];     // –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø—É—Ç–∏
  ignoreMethods?: string[];    // –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã
  durationBuckets?: number[]; // Buckets –¥–ª—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
  requestSizeBuckets?: number[]; // Buckets –¥–ª—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞
  responseSizeBuckets?: number[]; // Buckets –¥–ª—è –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã —Ä–∞–∑–º–µ—Ä–∞ –æ—Ç–≤–µ—Ç–∞
}

interface PredefinedMetricsConfig {
  counters?: CounterConfig[];     // –°–ø–∏—Å–æ–∫ Counter –º–µ—Ç—Ä–∏–∫ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  histograms?: HistogramConfig[]; // –°–ø–∏—Å–æ–∫ Histogram –º–µ—Ç—Ä–∏–∫ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  gauges?: GaugeConfig[];         // –°–ø–∏—Å–æ–∫ Gauge –º–µ—Ç—Ä–∏–∫ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  summaries?: SummaryConfig[];    // –°–ø–∏—Å–æ–∫ Summary –º–µ—Ç—Ä–∏–∫ –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
}
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# Prometheus –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
PROMETHEUS_METRICS_PATH=/metrics
PROMETHEUS_DEFAULT_METRICS=true
```

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏

```typescript
PrometheusClientModule.forRootAsync<[ConfigService]>({
  useFactory: (configService: ConfigService) => ({
    path: configService.get('PROMETHEUS_METRICS_PATH') || '/metrics',
    defaultMetrics: configService.get('PROMETHEUS_DEFAULT_METRICS') !== 'false',
    httpMetrics: {
      enabled: true,
      ignorePaths: ['/metrics', '/health'],
      ignoreMethods: ['OPTIONS'],
      durationBuckets: [0.005, 0.01, 0.025, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5, 10],
    },
    predefinedMetrics: {
      counters: [
        {
          name: 'custom_counter_total',
          help: 'Custom counter metric',
          labelNames: ['service'],
        },
      ],
      histograms: [
        {
          name: 'custom_histogram_seconds',
          help: 'Custom histogram metric',
          labelNames: ['method'],
          buckets: [0.1, 0.5, 1, 2, 5],
        },
      ],
    },
  }),
  inject: [ConfigService],
}),
```

## üìà –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª—è –º–µ—Ç—Ä–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞ `/metrics` endpoint —á–µ—Ä–µ–∑ @willsoto/nestjs-prometheus.

Prometheus –±—É–¥–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∞–¥—Ä–µ—Å—É:
- `http://localhost:5001/metrics` (api-service)
- `http://localhost:5002/metrics` (dashboard-service)
- `http://localhost:5003/metrics` (chat-service)

### –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Prometheus

```yaml
scrape_configs:
  - job_name: 'api-service'
    static_configs:
      - targets: ['localhost:5001']
    metrics_path: '/metrics'
  
  - job_name: 'dashboard-service'
    static_configs:
      - targets: ['localhost:5002']
    metrics_path: '/metrics'
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### HTTP –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä

```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ PrometheusHttpInterceptor
// –ú–µ—Ç—Ä–∏–∫–∏: http_requests_total, http_request_duration_seconds, http_request_size_bytes, http_response_size_bytes
```

### HTTP –º–µ—Ç—Ä–∏–∫–∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å

```typescript
const httpMetrics = httpMetricsService.recordHttpRequest(
  'GET',
  '/api/users',
  200,
  150,
  1024,
  2048,
  'UserController',
  'getUsers'
);
```

### Kafka –º–µ—Ç—Ä–∏–∫–∏

```typescript
const kafkaMetrics = kafkaMetricsService.recordKafkaMessage(
  'chat.service.commands',
  'CreateMessage',
  'success',
  50
);
```

### AI –º–µ—Ç—Ä–∏–∫–∏

```typescript
const aiMetrics = aiMetricsService.recordAiRequest(
  'success',
  3000,
  500,
  'gpt-4'
);
```

### Database –º–µ—Ç—Ä–∏–∫–∏

```typescript
import { createDatabaseMetricsSet } from '@makebelieve21213-packages/prometheus-client';

const dbMetrics = createDatabaseMetricsSet(prometheusService);

dbMetrics.databaseQueriesTotal.inc({ database: 'postgres', operation: 'select', status: 'success' });
const timer = dbMetrics.databaseQueryDuration.startTimer({ database: 'postgres', operation: 'select' });
// ... –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
timer();
```

### WebSocket –º–µ—Ç—Ä–∏–∫–∏

```typescript
const wsConnections = prometheusService.createGauge({
  name: 'websocket_connections',
  help: 'Number of active WebSocket connections',
  labelNames: ['room'],
});

wsConnections.set({ room: 'chat' }, 5);
wsConnections.inc({ room: 'chat' }, 1);
wsConnections.dec({ room: 'chat' }, 1);
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–∞–∫–µ—Ç –∏–º–µ–µ—Ç 100% –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:

```bash
cd prometheus-client
pnpm test
pnpm test:coverage
```

### –ú–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
import { Test } from '@nestjs/testing';
import { PrometheusService } from '@makebelieve21213-packages/prometheus-client';

const mockPrometheusService = {
  createCounter: jest.fn(),
  createHistogram: jest.fn(),
  createGauge: jest.fn(),
  createSummary: jest.fn(),
  getRegistry: jest.fn(),
};

const module = await Test.createTestingModule({
  providers: [
    MyService,
    {
      provide: PrometheusService,
      useValue: mockPrometheusService,
    },
  ],
}).compile();
```

## üèóÔ∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
- **TypeScript 5.7+** - —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- **ESM –º–æ–¥—É–ª–∏** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –º–æ–¥—É–ª–µ–π JavaScript
- **prom-client 15.x** - –∫–ª–∏–µ–Ω—Ç –¥–ª—è Prometheus –º–µ—Ç—Ä–∏–∫
- **NestJS 11.x** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

### –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏
–ü–∞–∫–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω—É—é —Å–±–æ—Ä–∫—É –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã ESM:
1. **TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è** (`tsc --build`) - –∫–æ–º–ø–∏–ª—è—Ü–∏—è TypeScript –≤ JavaScript
2. **–ó–∞–º–µ–Ω–∞ –∞–ª–∏–∞—Å–æ–≤** (`tsc-alias`) - –∑–∞–º–µ–Ω–∞ –ø—É—Ç–µ–π `src/*` –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ
3. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ESM** (`tsc-esm-fix`) - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `.js` —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∫ –∏–º–ø–æ—Ä—Ç–∞–º

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pnpm install

# –°–±–æ—Ä–∫–∞
pnpm build

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pnpm test

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pnpm test:coverage

# –õ–∏–Ω—Ç–µ—Ä
pnpm lint
pnpm lint:fix

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
pnpm format
pnpm format:fix
```

## üê≥ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Docker –ª–æ–∫–∞–ª—å–Ω–æ

### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞

–°–æ–±–µ—Ä–∏—Ç–µ Docker –æ–±—Ä–∞–∑ –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞:

```bash
docker build -t prometheus-client-package:latest .
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

#### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
docker run -d \
  --name prometheus-client-package \
  prometheus-client-package:latest
```

#### –° –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
docker run -d \
  --name prometheus-client-package \
  -e PROMETHEUS_METRICS_PATH=/metrics \
  -e PROMETHEUS_DEFAULT_METRICS=true \
  prometheus-client-package:latest
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Ç—Ä–∏–∫

```bash
# –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ /metrics endpoint
curl http://localhost:5001/metrics
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker stop prometheus-client-package

# –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker rm prometheus-client-package

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
docker rm -f prometheus-client-package
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ docker-compose

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `docker-compose.yml`:

```yaml
version: '3.8'

services:
  prometheus-client:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: prometheus-client-package
    environment:
      - PROMETHEUS_METRICS_PATH=/metrics
      - PROMETHEUS_DEFAULT_METRICS=true
    ports:
      - "5001:5001"
    networks:
      - prometheus-network
    restart: unless-stopped

  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    networks:
      - prometheus-network
    restart: unless-stopped

networks:
  prometheus-network:
    driver: bridge
```

–ó–∞–ø—É—Å–∫:

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f prometheus-client

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

## üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### ESM –ø–∞–∫–µ—Ç
–ü–∞–∫–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ESM (ECMAScript Modules):
- `"type": "module"` –≤ package.json
- –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç ESM —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ `exports` –ø–æ–ª—è –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π
- –°–æ–≤–º–µ—Å—Ç–∏–º —Å Node.js 22.11+ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ bundler'–∞–º–∏

### Global Module
PrometheusClientModule –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ `@Global()`:
- –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è **–æ–¥–∏–Ω —Ä–∞–∑** –≤ AppModule
- –î–æ—Å—Ç—É–ø–µ–Ω –≤–æ **–≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö** –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `forRootAsync()`

### –ì–ª–æ–±–∞–ª—å–Ω—ã–π Registry
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π Registry –æ—Ç `prom-client` (`register`)
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å @willsoto/nestjs-prometheus
- –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞ `/metrics` endpoint

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫
- –ú–µ—Ç—Ä–∏–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ —Å–µ—Ä–≤–∏—Å–∞ —á–µ—Ä–µ–∑ `PrometheusService`
- –ú–µ—Ç—Ä–∏–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º Registry –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

### –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫
- –ú–µ—Ç—Ä–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞ `/metrics` endpoint —á–µ—Ä–µ–∑ @willsoto/nestjs-prometheus
- Endpoint –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `path` –≤ `PrometheusModuleOptions`
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: `/metrics`

### –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- `HttpMetricsService`, `KafkaMetricsService`, `AiMetricsService` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –≥–æ—Ç–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –∑–∞–ø–∏—Å–∏ –º–µ—Ç—Ä–∏–∫
- –£–ø—Ä–æ—â–∞—é—Ç —Ä–∞–±–æ—Ç—É —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### HTTP –ò–Ω—Ç–µ—Ä—Ü–µ–ø—Ç–æ—Ä
- `PrometheusHttpInterceptor` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç HTTP –º–µ—Ç—Ä–∏–∫–∏
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `httpMetrics` –≤ `PrometheusModuleOptions`
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π –∏ –º–µ—Ç–æ–¥–æ–≤

### –†–µ–µ—Å—Ç—Ä –º–µ—Ç—Ä–∏–∫
- `MetricRegistry` —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –ú–µ—Ç—Ä–∏–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª—è
- –î–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥—ã `getCounter()`, `getHistogram()`, `getGauge()`, `getSummary()`

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

## ü§ù Contribution

Pull requests –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è! –î–ª—è –∫—Ä—É–ø–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ issue –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è.

## ‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### –ü–æ—á–µ–º—É –º–µ—Ç—Ä–∏–∫–∏ –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –Ω–∞ /metrics?
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ PrometheusClientModule –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ AppModule
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π Registry (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å `/metrics` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø—É—Ç—å –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–µ—Ç—Ä–∏–∫?
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `path` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `PrometheusModuleOptions`.

### –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ Node.js?
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `defaultMetrics: false` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `PrometheusModuleOptions`.

### –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä HTTP –º–µ—Ç—Ä–∏–∫?
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `httpMetrics.enabled: false` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `PrometheusModuleOptions` –∏–ª–∏ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ `PrometheusHttpInterceptor`.

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏?
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ `predefinedMetrics` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª—è –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `MetricRegistry` –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç—Ä–∏–∫–∞–º.

### –ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Global Module?
–ß—Ç–æ–±—ã PrometheusService –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞. –≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Registry?
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π Registry –æ—Ç `prom-client`, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è @willsoto/nestjs-prometheus –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–µ—Ç—Ä–∏–∫ –Ω–∞ `/metrics` endpoint.
